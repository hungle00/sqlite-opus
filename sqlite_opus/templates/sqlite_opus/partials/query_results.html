{# Flask partial: query results table + pagination bar #}
<div id="results-container" class="results-container">
  {% if not success %}
    <div class="error-message">{{ error }}</div>
  {% elif not results and not (pagination and pagination.total_count) %}
    <p class="empty-message">No results returned</p>
  {% else %}
    <table class="results-table">
      <thead>
        <tr>
          {% for col in columns %}
          <th>{{ col }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in results %}
        <tr>
          {% for col in columns %}
          <td>{{ row[col] if row[col] is not none else '' }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% endif %}
</div>
<div id="pagination-bar" class="pagination-bar" aria-label="Result pagination"
  {% if not pagination or pagination.total_pages <= 1 and not (pagination and pagination.total_count > 0) %}
  style="display: none;"
  {% else %}
  style="display: block;"
  {% endif %}>
  {% if pagination and pagination.total_count > 0 %}
    {% if pagination.total_pages > 1 %}
      {% set start = (pagination.page - 1) * pagination.per_page + 1 %}
      {% set end = [pagination.page * pagination.per_page, pagination.total_count] | min %}
      <div class="pagination-controls">
        <span class="pagination-info">{{ start }}&ndash;{{ end }} of {{ pagination.total_count }}</span>
        <span class="pagination-buttons">
          {% if pagination.page > 1 %}
          <button type="button" class="btn btn-sm btn-outline-secondary pagination-btn" data-page="{{ pagination.page - 1 }}" aria-label="Previous">Prev</button>
          {% endif %}
          {% for i in page_numbers %}
            {% if loop.index > 1 and i > page_numbers[loop.index - 2] + 1 %}
            <span class="pagination-ellipsis">â€¦</span>
            {% endif %}
            <button type="button" class="btn btn-sm {{ 'btn-primary' if i == pagination.page else 'btn-outline-secondary' }} pagination-btn" data-page="{{ i }}">{{ i }}</button>
          {% endfor %}
          {% if pagination.page < pagination.total_pages %}
          <button type="button" class="btn btn-sm btn-outline-secondary pagination-btn" data-page="{{ pagination.page + 1 }}" aria-label="Next">Next</button>
          {% endif %}
        </span>
      </div>
    {% else %}
      <span class="pagination-info">Page 1 of 1 ({{ pagination.total_count }} row{{ 's' if pagination.total_count != 1 else '' }})</span>
    {% endif %}
  {% endif %}
</div>
